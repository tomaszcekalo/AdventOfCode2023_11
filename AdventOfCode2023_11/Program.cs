// See https://aka.ms/new-console-template for more information
Console.WriteLine("Hello, World!");

var input = @".....................#..................#..................................................................#...........#....................
................................................................#..................#........................................................
..........................#.....#.............................................................#........#..................................#.
...#.......#...........................................#........................................................#...........................
............................................................................................................................................
........................................................................#.....#.................................................#......#....
...............................................#.................#...................#......#..............#................................
.................#.................#.....................................................................................#.................#
......................#....................................................#................................................................
...........#.......................................................................................#........................................
...........................#......................#............................#.......#.....................................#..............
........................................................#......#.......#................................#.........................#......#..
...............................................................................................#............................................
.#.....................#..................#.....................................................................#...........................
..............................#......#.................................................................................#....................
................#....................................#.......................#..............................................................
........#...................................................................................#..............................................#
.........................#....................................#.......................................#............#........................
...................................................................#..............#.........................................................
..................................#...........#...............................................................#.............................
.#.................................................................................................#.....................#..................
.........#...................................................................................#..............................................
..............#........................#...............#.............#...............................................................#......
..........................#............................................................................#.............#......................
.................................................................................#.....#....................................................
.......#...................................................#...............#....................................................#...........
....................................#.......#.....................................................#.........................................
#...............................................................#.....................................................................#.....
...............#..................................#.........................................................#..........#....................
................................#.................................................................................................#.........
.........................#.......................................................#.........................................................#
............................................................#...........#...............#...................................................
....#......#.....................................................#..........................................................................
........................................................................................................#.......................#.....#.....
.............................................................................................#..............................................
....................................#........#.......................................#.....................................#................
...........................................................................................................#.......#........................
#........................#.............................#..........................................................................#.........
...........#......................................#.........................#..........................#.................................#..
................#.....................#...........................................#.........................................................
...#.............................#...........................................................................#.........#....................
............................................#.......................#...........................#...........................................
.....................................................................................................#......................#...............
#.........................................................................................#.................................................
.............................#.......................................................................................#....................#.
...........#.............................#......#........#.....#.......#......#.............................#...............................
...................#........................................................................................................................
...................................................................................................................................#........
.#............#.............................#......#...............................#....................................#...................
..........................#.........#...................................................................#...................................
.....................................................................#.............................#...........................#............
................................................................................................................#...........................
...........................................................#..................................#.............................................
........#....................#....................................#...................#.................................................#...
...#...............#.............................#.....................................................................#....................
.........................#..........#.....#................................#........................#.......................................
................................................................................#..............................#................#...........
............................................................................................................................................
....................................................................................#........#..............................................
............................................................#..........#..........................#.........................................
.............................#........#................#................................................#...............#...................
......................#............................................#........................................................................
.#..........#.........................................................................#.....................................................
..................#..........................................................................................#...................#..........
.......#.........................#................#..........................#.......................#................#................#....
.........................................................#..................................................................................
.....................................................................#......................................................................
............................................#...................#....................#.............................#........................
......................................#.....................................................................................................
...#.......................................................................................................................#................
.......................#..........................#......................................................#.....#............................
.................................#..........................................................................................................
.............#....................................................#........#...........................................................#....
............................................................................................................................................
............................................................................................................................................
.................................................#.....#....................................#......................#..............#.........
.................#............................................................#.............................#.............................#.
............#............................#.........................................#.............#..........................................
.......#...............#........................................................................................#...........................
..................................#............#..............#.....#..................................#....................................
...........................................................................#................................................................
..#.......#.....#............#...........................#............................#..............................#......................
........................................#.......................................#.................#.......................................#.
............................................................................................................................................
..........................#.......................#..............#..........................................................................
..................................#.........................................................................................................
.#..................................................................................................................#.......................
................#.....................#.....................#...............#...................#............#..............................
.........#..................................................................................................................................
................................#..............#........................#.................#........................................#........
............................................................................................................................................
#...................#...................#.......................................................................#........................#..
............................#....................................#............#.......#....................#................................
............................................................#......................................#........................................
...................................................................................................................#.........#..............
..................................................#.................#....................#..............................#...................
........................#..............................#..........................#.........................................................
............#..........................#...................................#.....................#.......#..........................#.......
..................#.............#...........................................................................................................
.....#......................................................................................................................................
.......................................................................#..............................................#.....................
.........#................#................................#........................#.......................#...............................
....................#................#.......#.....................................................................................#........
..................................................#.........................#........................#.............#..........#.............
.#...................................................................#......................................................................
.................................................................................#......#.....................#........#....................
.....#...................................#..................................................................................................
.....................................................#.................................................#....................................
..............#...................#.............................#.................................................................#......#..
........#...........#.......................................................................#.............................#.................
.................................................................................................#..........................................
..........................................................................................................#.....#...........................
..........................#........................#........................................................................................
.#................#.......................#.......................................#..................................#......................
.........#.....................#.....#.................................................................................................#....
............................................................................................#...............................................
.....................................................................#.......................................#..............................
..............................................#............................#............................#.....................#.............
.........................................#................#......................................#.....................#....................
................................#...........................................................................................................
#.....#.........#...............................................#.............#.............................................................
...........................#.......................................................#......................#.................#.......#......#
...........................................................................................#........#.......................................
....................#...................#................#..............#...................................................................
..............................................................#.............................................................................
..........#.......................#..................................................#...............................#......................
...............#..............................................................................#........#.............................#......
.........................#...................#.......#.............#...........................................#...........#................
.....................................#....................................................#.................................................
....................#.............................................................#.....................................................#...
.......#....................................................................#...............................................................
...............................................................#....................................#...........................#...........
...............#...........................#..........................................................................#.....................
.................................#......................................................#...........................................#.......
#........#.........................................#......#.................................................................................
..............................................................................#..........................#..................................
.....#..................#...................................................................................................................
.......................................................#.......#.....#...........................................#.............#............
....................#...............#............#..........................................................................................
.................................................................................#......#..............................................#....";

var inputsmall = @"...#......
.......#..
#.........
..........
......#...
.#........
.........#
..........
.......#..
#...#.....";

new CosmicExpansionCalculator().CalculateDistance(input, 2);
new CosmicExpansionCalculator().CalculateDistance(input, 1000000 - 1);

public class CosmicExpansionCalculator
{
    public int CalculateDistance(string input, int expandBy, bool displayLogs = false)
    {
        var lines = input.Split(System.Environment.NewLine);
        List<Galaxy> galaxies = new List<Galaxy>();
        int id = 0;

        for (int y = 0; y < lines.Length; y++)
        {
            for (int x = 0; x < lines[y].Length; x++)
            {
                if (lines[y][x] == '#')
                    galaxies.Add(new Galaxy()
                    {
                        X = x,
                        Y = y,
                        Id = ++id
                    }); ;
            }
        }
        Int128 shouldExpandX = 0;
        Int128 shouldExpandY = 0;
        List<int> expandX = new List<int>();
        List<int> expandY = new List<int>();
        for (int y = 0; y < lines.Length; y++)
        {
            if (lines[y].Contains("#"))
            {
                galaxies.Where(g => g.Y == y).ToList().ForEach(g =>
                {
                    g.ShouldExpandY = shouldExpandY;
                });
            }
            else
            {
                expandY.Add(y);
                shouldExpandY += expandBy;
            }
        }
        for (int x = 0; x < lines[0].Length; x++)
        {
            if (lines.Select(l => l[x]).Contains('#'))
            {
                galaxies.Where(g => g.X == x).ToList().ForEach(g =>
                {
                    g.ShouldExpandX = shouldExpandX;
                });
            }
            else
            {
                expandX.Add(x);
                shouldExpandX += expandBy;
            }
        }
        if (displayLogs)
        {
            DisplayA(lines, expandX, expandY);
            Console.WriteLine();
        }
        var sum = GetAllDistances(galaxies);
        return 0;
    }

    public Int128 GetAllDistances(List<Galaxy> galaxies, bool displayPairs = false)
    {
        Int128 sum = 0;
        int pairs = 0;
        foreach (Galaxy g in galaxies)
        {
            g.X += g.ShouldExpandX;
            g.Y += g.ShouldExpandY;
        };
        foreach (Galaxy g in galaxies)
        {
            foreach (Galaxy g2 in galaxies.Where(x => x.Id > g.Id))
            {
                var distance = Int128.Abs(g.X - g2.X) + Int128.Abs(g.Y - g2.Y);
                if (displayPairs)
                    Console.WriteLine($"Between galaxy {g.Id} and galaxy {g2.Id}: {distance}");
                sum += distance;
                pairs++;
            }
        }
        Console.WriteLine($"In this example, after expanding the universe, the sum of the shortest path between all {pairs} pairs of galaxies is {sum}.");
        return sum;
    }

    public void DisplayA(string[] lines, List<int> expandX, List<int> expandY)
    {
        Console.Write(" ");
        for (int x = 0; x <= expandX.Max(); x++)
        {
            if (expandX.Contains(x))
                Console.Write("V");
            else
                Console.Write(" ");
        }
        Console.WriteLine();
        for (int y = 0; y < lines.Length; y++)
        {
            if (expandY.Contains(y))
                Console.Write(">");
            else
                Console.Write(" ");
            Console.Write(lines[y]);
            if (expandY.Contains(y))
                Console.WriteLine("<");
            else
                Console.WriteLine(" ");
        }
        Console.Write(" ");
        for (int x = 0; x <= expandX.Max(); x++)
        {
            if (expandX.Contains(x))
                Console.Write("^");
            else
                Console.Write(" ");
        }
    }
}

public class Galaxy
{
    public Int128 X { get; set; }
    public Int128 Y { get; set; }
    public Int128 ShouldExpandX { get; set; }
    public Int128 ShouldExpandY { get; set; }
    public int Id { get; internal set; }
}